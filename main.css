const express = require('express');
const { Client, Intents } = require('discord.js');
const app = express();
app.use(express.json());

app.post('/api/login', async (req, res) => {
    const { token } = req.body;
    const client = new Client({ intents: [Intents.FLAGS.GUILDS] });

    try {
        await client.login(token);

        const user = client.user;
        const guilds = client.guilds.cache.map(guild => ({
            id: guild.id,
            name: guild.name,
            iconURL: guild.iconURL() || 'https://via.placeholder.com/64'
        }));

        res.json({ user: { id: user.id, username: user.username }, guilds });
    } catch (error) {
        res.status(401).json({ message: 'Invalid token' });
    }
});

app.listen(3001, () => console.log('API server running on http://localhost:3001'));
